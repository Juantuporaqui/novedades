<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SIREX · Gestión Avanzada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <!-- Bootstrap 5 y Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Estilos propios gestión institucional -->
  <link rel="stylesheet" href="../css/grupo1.css">
  <link rel="stylesheet" href="../css/gestion.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;400&display=swap" rel="stylesheet">
  <style>
    /* Fondo institucional para toda la página */
    body.bg-police {
      background: linear-gradient(135deg, #193768 70%, #38588e 100%);
      min-height: 100vh;
    }
    .header, footer { display: none; } /* Ocultamos el header antiguo, footer lo trasladamos abajo con estilo institucional */
  </style>
</head>
<body class="bg-police">
  <!-- NAVBAR ESTILO INSTITUCIONAL -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-police-blue shadow-sm mb-3">
    <div class="container">
      <img src="../img/logo_cnp.png" alt="CNP" width="42" height="42" class="me-2 d-none d-md-block">
      <span class="navbar-brand fs-3 fw-bold">SIREX · Gestión Avanzada</span>
      <button id="darkModeBtn" class="modo-oscuro-btn" title="Modo oscuro"><i class="bi bi-moon-stars"></i></button>
      <a href="../index.html" class="btn btn-outline-light ms-auto"><i class="bi bi-house-door"></i> Menú principal</a>
    </div>
  </nav>
  <!-- PARA MÓVIL -->
  <div class="text-center mb-2 d-md-none">
    <a href="../index.html" class="btn btn-outline-primary btn-sm"><i class="bi bi-house-door"></i> Menú principal</a>
  </div>

  <section id="statusFirebase" aria-live="polite"></section>

  <main>
    <div class="container my-4">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <!-- Card Barra Superior -->
          <div class="card bg-police-dark text-white shadow mb-4 p-3">
            <div class="row g-2 align-items-end">
              <div class="col-12 col-md-4 mb-2 mb-md-0">
                <label for="fechaRegistro" class="form-label mb-1">Fecha del registro</label>
                <input type="date" id="fechaRegistro" class="form-control form-control-lg" autocomplete="off" required>
              </div>
              <div class="col-6 col-md-2">
                <button id="btnCargar" class="btn btn-police-blue w-100 btn-lg" type="button"><i class="bi bi-upload"></i> Cargar</button>
              </div>
              <div class="col-6 col-md-2">
                <button id="btnGuardar" class="btn btn-police-green w-100 btn-lg" type="button"><i class="bi bi-save"></i> Guardar</button>
              </div>
              <div class="col-6 col-md-2">
                <button id="btnEliminar" class="btn btn-police-red w-100 btn-lg" type="button"><i class="bi bi-trash"></i> Eliminar</button>
              </div>
              <div class="col-6 col-md-2">
                <button id="btnNuevo" class="btn btn-secondary w-100 btn-lg" type="button"><i class="bi bi-plus-lg"></i> Nuevo</button>
              </div>
            </div>
            <div class="row mt-2">
              <div class="col-12 text-end">
                <span class="badge bg-info text-dark py-2 px-2 w-100">Guardado online automático</span>
              </div>
            </div>
          </div>

          <section id="historialFechas"></section>

          <!-- FORMULARIO PRINCIPAL EN TARJETA -->
          <div class="card shadow-lg p-4 mb-4">
            <h2 class="mb-4 text-police-blue">
              <i class="bi bi-folder2-open"></i> Gestión Oficial (Parte Diario)
            </h2>
            <form id="formGestion" autocomplete="off">
              <!-- FILA 1 -->
              <div class="row g-3 mb-3">
                <div class="col-6 col-md-3">
                  <label for="citas" class="form-label">Citas</label>
                  <input type="number" min="0" id="citas" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="fallosCitas" class="form-label">Fallos</label>
                  <input type="number" min="0" id="fallosCitas" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="entrevistasAsilo" class="form-label">Entrev. Asilo</label>
                  <input type="number" min="0" id="entrevistasAsilo" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="fallosAsilo" class="form-label">Fallos Asilo</label>
                  <input type="number" min="0" id="fallosAsilo" class="form-control" value="0">
                </div>
              </div>
              <!-- FILA 2 -->
              <div class="row g-3 mb-3">
                <div class="col-6 col-md-3">
                  <label for="asilosConcedidos" class="form-label">Asilos Concedidos</label>
                  <input type="number" min="0" id="asilosConcedidos" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="asilosDenegados" class="form-label">Asilos Denegados</label>
                  <input type="number" min="0" id="asilosDenegados" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="cartasConcedidas" class="form-label">Cartas Concedidas</label>
                  <input type="number" min="0" id="cartasConcedidas" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="cartasDenegadas" class="form-label">Cartas Denegadas</label>
                  <input type="number" min="0" id="cartasDenegadas" class="form-control" value="0">
                </div>
              </div>
              <!-- FILA 3 -->
              <div class="row g-3 mb-3">
                <div class="col-6 col-md-3">
                  <label for="proteccionInternacional" class="form-label">Prot. Internacional</label>
                  <input type="number" min="0" id="proteccionInternacional" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="citasSubdeleg" class="form-label">Citas Subdeleg.</label>
                  <input type="number" min="0" id="citasSubdeleg" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="tarjetasSubdeleg" class="form-label">Tarjetas Subdeleg.</label>
                  <input type="number" min="0" id="tarjetasSubdeleg" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="notificacionesConcedidas" class="form-label">Notific. Concedidas</label>
                  <input type="number" min="0" id="notificacionesConcedidas" class="form-control" value="0">
                </div>
              </div>
              <!-- FILA 4 -->
              <div class="row g-3 mb-3">
                <div class="col-6 col-md-3">
                  <label for="notificacionesDenegadas" class="form-label">Notific. Denegadas</label>
                  <input type="number" min="0" id="notificacionesDenegadas" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="presentados" class="form-label">Presentados</label>
                  <input type="number" min="0" id="presentados" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="correosUcrania" class="form-label">Correos Ucrania</label>
                  <input type="number" min="0" id="correosUcrania" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="telematicasFavorables" class="form-label">Tele. Favorables</label>
                  <input type="number" min="0" id="telematicasFavorables" class="form-control" value="0">
                </div>
              </div>
              <!-- FILA 5 -->
              <div class="row g-3 mb-3">
                <div class="col-6 col-md-3">
                  <label for="telematicasDesfavorables" class="form-label">Tele. Desfavorables</label>
                  <input type="number" min="0" id="telematicasDesfavorables" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="citasTlfnAsilo" class="form-label">Citas Tlf. Asilo</label>
                  <input type="number" min="0" id="citasTlfnAsilo" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="citasTlfnCartas" class="form-label">Citas Tlf. Cartas</label>
                  <input type="number" min="0" id="citasTlfnCartas" class="form-control" value="0">
                </div>
                <div class="col-6 col-md-3">
                  <label for="oficios" class="form-label">Oficios</label>
                  <input type="number" min="0" id="oficios" class="form-control" value="0">
                </div>
              </div>
              <!-- Observaciones -->
              <div class="row g-3 mb-2">
                <div class="col-12">
                  <label for="observaciones" class="form-label">Observaciones</label>
                  <textarea id="observaciones" rows="2" class="form-control" placeholder="Observaciones, incidencias..."></textarea>
                </div>
              </div>
            </form>
          </div>

          <!-- PANEL RESUMEN -->
          <section id="panelResumen" class="card shadow p-4 mb-4" style="display:none;">
            <h2 class="mb-3 text-police-blue"><i class="bi bi-journal-check"></i> Resumen del registro</h2>
            <div id="resumenRegistro"></div>
          </section>

          <!-- PANEL RESUMEN POR FECHAS Y EXPORTAR -->
          <section class="card panel-glass mt-4 p-4">
            <h3 class="mb-3 text-police-blue"><i class="bi bi-clipboard-data"></i> Resumen por rango de fechas</h3>
            <div class="row-cols mb-3 d-flex flex-wrap gap-3 align-items-center">
              <label for="resumenDesde" class="form-label mb-0">Desde</label>
              <input type="date" id="resumenDesde" class="form-control input-date">
              <label for="resumenHasta" class="form-label mb-0">Hasta</label>
              <input type="date" id="resumenHasta" class="form-control input-date">
              <button type="button" class="btn btn-police-blue" id="btnResumenFechas"><i class="bi bi-bar-chart"></i> Mostrar Resumen</button>
            </div>
            <div id="divResumenFechas"></div>
            <div class="export-btns d-flex flex-wrap gap-2 mt-3">
              <button type="button" class="btn btn-police-yellow" id="btnExportarPDF"><i class="bi bi-file-earmark-pdf"></i> Exportar PDF</button>
              <button type="button" class="btn btn-police-green" id="btnExportarCSV"><i class="bi bi-file-earmark-spreadsheet"></i> Exportar CSV</button>
              <button type="button" class="btn btn-police-blue" id="btnWhatsapp"><i class="bi bi-whatsapp"></i> Resumen WhatsApp</button>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  <!-- FOOTER CORPORATIVO INSTITUCIONAL -->
  <footer class="footer bg-police-blue text-white text-center py-3 mt-5">
    <small>
      &copy; 2025 UCRIF · Benito · Gestión Avanzada | Plataforma policial
    </small>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore-compat.js"></script>
  <script src="../js/gestion.js" defer></script>
  <!-- Script Modo Oscuro -->
  <script>
    // =========== MODO OSCURO =========== 
    const darkBtn = document.getElementById("darkModeBtn");
    if (darkBtn) {
      darkBtn.onclick = function() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("sirex_darkmode", document.body.classList.contains("dark-mode") ? "1" : "0");
      };
      if (localStorage.getItem("sirex_darkmode") === "1") {
        document.body.classList.add("dark-mode");
      }
    }
  </script>
</body>
</html>
