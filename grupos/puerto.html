<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SIREX · Grupo Puerto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/puerto.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;400&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="../img/logo_cnp.png">
</head>
<body>
  <!-- HEADER -->
  <header class="puerto-header">
    <button class="btn-menu" onclick="window.location.href='../index.html'" title="Volver al menú principal">🏠</button>
    <div class="puerto-logo"><span style="font-size:48px; display:inline-block;">⚓️</span></div>
    <div class="puerto-title">
      <span class="title-main">GRUPO PUERTO</span>
      <span class="title-desc">Control y Estadística Portuaria</span>
    </div>
    <div class="top-actions-bar-header">
      <button type="button" class="btn-cargar" id="btnCargar" title="Cargar registro"><span>📂</span>Cargar</button>
      <button type="button" class="btn-nuevo" id="btnNuevo" title="Nuevo registro"><span>🆕</span>Nuevo</button>
      <button type="submit" form="formPuerto" class="btn-guardar" id="btnGuardarRegistro" title="Guardar"><span>💾</span>Guardar</button>
    </div>
    <button id="darkModeBtn" class="modo-oscuro-btn" title="Modo día/noche">🌙</button>
  </header>

  <main class="main-container">
    <form id="formPuerto" autocomplete="off">
      <section class="panel panel-glass">

        <!-- Fecha -->
        <div class="row-cols fecha-row">
          <label for="fechaPuerto">Fecha</label>
          <input type="date" id="fechaPuerto" required class="form-control input-date">
        </div>

        <!-- Marinos/Cruceros/Visados -->
        <div class="row-cols">
          <div class="form-grid responsive-grid">
            <label for="marinosArgos">Marinos<br>Argos</label>
            <input type="number" min="0" id="marinosArgos" placeholder="Argos">
            <label for="controlPasaportes">Pasaportes<br>Marinos</label>
            <input type="number" min="0" id="controlPasaportes" placeholder="Pasaportes">
            <label for="cruceros">Cruceros</label>
            <input type="number" min="0" id="cruceros" placeholder="Cruceros">
            <label for="cruceristas">Cruceristas</label>
            <input type="number" min="0" id="cruceristas" placeholder="Pasajeros">
            <label for="visadosValencia">Visados<br>Valencia</label>
            <input type="number" min="0" id="visadosValencia" placeholder="Valencia">
            <label for="visadosCG">Visados<br>CG</label>
            <input type="number" min="0" id="visadosCG" placeholder="CG">
            <label for="puertoDeportivo">Pto.<br>Deportivo</label>
            <input type="number" min="0" id="puertoDeportivo" placeholder="Registros">
            <label for="denegaciones">Deneg.</label>
            <input type="number" min="0" id="denegaciones" placeholder="Denegaciones">
            <label for="certificadosEixics">Cert. EIXICS</label>
            <input type="number" min="0" id="certificadosEixics" placeholder="EIXICS">
          </div>
        </div>

        <!-- NUEVO: FERRYS -->
        <div class="mb-3 ferrys-block">
          <h4>
            FERRYS
            <button class="ayuda-btn" type="button" title="Ayuda sobre ferrys" onclick="alert('Añade cada ferry indicando fecha, hora, llegada o salida, pasajeros y vehículos. Puedes ver los ferry añadidos abajo y borrarlos si es necesario.')">?</button>
          </h4>
          <!-- Mini-formulario ferry -->
          <div class="ferry-mini-form-wrap">
            <div class="ferry-mini-form" id="ferryMiniForm">
              <select id="ferryTipo" class="form-control" title="Tipo">
                <option value="Llegada">Llegada</option>
                <option value="Salida">Salida</option>
              </select>
              <input type="date" id="ferryFecha" class="form-control" title="Fecha">
              <input type="time" id="ferryHora" class="form-control" title="Hora">
              <input type="number" min="0" id="ferryPasajeros" class="form-control" placeholder="Pasaj." title="Pasajeros">
              <input type="number" min="0" id="ferryVehiculos" class="form-control" placeholder="Vehíc." title="Vehículos">
              <button type="button" class="btn-add-ferry" id="btnAddFerry" title="Añadir ferry">➕ Añadir</button>
            </div>
          </div>
          <!-- Ventana/listado de ferrys añadidos -->
          <div id="ferrysListWindow" class="ventana-ferrys"></div>
          <!-- Totales -->
          <div class="totales-ferry">
            <b>Ferrys:</b> <span id="totalFerrys">0</span> |
            <b>Pasaj.:</b> <span id="totalPasajeros">0</span> |
            <b>Vehíc.:</b> <span id="totalVehiculos">0</span>
          </div>
        </div>

        <!-- OBSERVACIONES -->
        <div class="control-group observaciones-box">
          <label for="observaciones">
            Observaciones
            <button class="ayuda-btn" type="button" title="Añade cualquier nota relevante" onclick="alert('Aquí puedes anotar cualquier observación relevante, incidencias, etc.')">?</button>
          </label>
          <textarea id="observaciones" class="form-control" placeholder="Observaciones, incidencias..."></textarea>
        </div>

        <!-- Adjuntos -->
        <div class="control-group">
          <label>Adjuntar doc./imágenes</label>
          <input type="file" id="adjuntos" class="form-control" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
        </div>
      </section>
    </form>

    <!-- RESUMEN AVANZADO / EXPORTACIÓN -->
    <section class="panel panel-glass mt-4" id="panelResumenAvanzado">
      <h3>Resumen avanzado 
        <button class="ayuda-btn" type="button" title="Resumen y exportación" onclick="alert('Puedes generar un resumen por rango de fechas y exportar los datos en PDF, CSV o copiar para WhatsApp.')">?</button>
      </h3>
      <div class="row-cols mb-2 resumen-fechas-row">
        <label for="desdeResumen">Desde</label>
        <input type="date" id="desdeResumen" class="form-control input-date">
        <label for="hastaResumen">Hasta</label>
        <input type="date" id="hastaResumen" class="form-control input-date">
      </div>
      <div class="export-btns resumen-btns-grid">
        <button id="btnExportarPDF" class="btn btn-pdf" type="button" title="Exportar PDF"><span>📄</span>PDF</button>
        <button id="btnExportarCSV" class="btn btn-guardar" type="button" title="Exportar CSV"><span>📊</span>CSV</button>
        <button id="btnWhatsapp" class="btn btn-menu" type="button" title="Compartir WhatsApp"><span>💬</span>WA</button>
        <button id="btnGenerarResumen" class="btn btn-guardar" type="button" title="Generar resumen"><span>📋</span>Resumen</button>
      </div>
      <div id="resumenAvanzadoVentana" class="ventana-datos mt-3"></div>
    </section>

    <section class="panel panel-glass mt-4" id="panelResumenPuerto" style="display:none;">
      <h3>Resumen del día</h3>
      <div id="resumenPuerto"></div>
    </section>
  </main>
  <footer class="footer">
    SIREX · UCRIF · Grupo Puerto &copy; 2025
  </footer>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-storage-compat.js"></script>
  <script src="puerto.js"></script>
  <script>
    // =========== MODO OSCURO =========== 
    const darkBtn = document.getElementById("darkModeBtn");
    if (darkBtn) {
      darkBtn.onclick = function() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("sirex_darkmode", document.body.classList.contains("dark-mode") ? "1" : "0");
        darkBtn.innerText = document.body.classList.contains("dark-mode") ? "☀️" : "🌙";
      };
      if (localStorage.getItem("sirex_darkmode") === "1") {
        document.body.classList.add("dark-mode");
        darkBtn.innerText = "☀️";
      }
    }
  </script>
</body>
</html>
