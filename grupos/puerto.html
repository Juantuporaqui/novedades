<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SIREX · Grupo Puerto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/grupo1.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;400&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="../img/logo_cnp.png">
  <style>
    .row-cols {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5em;
      align-items: center;
      margin-bottom: 1.2em;
    }
    .mini-form-ferry input, .mini-form-ferry select {
      min-width: 120px;
      margin-bottom: 7px;
    }
    .mini-form-ferry {
      display: flex; flex-wrap: wrap; gap: 0.7em; align-items: center;
    }
    .totales-ferry {
      font-weight: 700; margin-top: .7em;
      color: #29497a;
      font-size: 1.08em;
    }
    .ventana-ferrys .dato-item {
      margin-bottom: 2px;
      background: #f8fafc;
    }
    .ferry-incidencia {
      font-size: 0.97em;
      color: #3d4c67;
      margin-left: 1.6em;
      font-style: italic;
    }
    @media (max-width: 750px) {
      .row-cols, .mini-form-ferry { flex-direction: column; align-items: stretch; }
    }
  </style>
</head>
<body class="bg-police">

  <!-- HEADER -->
  <header class="navbar navbar-expand bg-police-blue card" style="padding: 1.2em 1.6em; border-radius: 0 0 19px 19px;">
    <span class="navbar-brand" style="font-size:2.4em; color:#ffd94a;">⚓️</span>
    <span class="navbar-brand" style="font-weight:900; letter-spacing:2px; font-size:1.38em;">SIREX - Grupo Puerto</span>
    <div class="ms-auto d-flex align-items-center" style="margin-left:auto;">
      <button class="btn btn-police-yellow" onclick="window.location.href='../index.html'" title="Volver al menú principal">🏠</button>
      <button id="darkModeBtn" class="modo-oscuro-btn" title="Modo día/noche">🌙</button>
    </div>
  </header>

  <main class="container" style="max-width:750px; margin:32px auto 0;">
    <form id="formPuerto" autocomplete="off">
      <div class="card p-4">
        <!-- Fecha y acciones -->
        <div class="row-cols">
          <label for="fechaPuerto">Fecha de trabajo</label>
          <input type="date" id="fechaPuerto" class="form-control" required>
          <button type="button" class="btn btn-police-yellow" id="btnCargar"><span>📂</span> Cargar</button>
          <button type="button" class="btn btn-police-blue" id="btnNuevo"><span>🆕</span> Nuevo</button>
          <button type="submit" class="btn btn-police-green" id="btnGuardarRegistro"><span>💾</span> Guardar</button>
        </div>
        
        <!-- Estadísticas principales -->
        <h4 class="mt-4">Estadísticas portuarias</h4>
        <div class="row-cols" style="gap:1.1em;">
          <label>Ctrl. Marinos <input type="number" min="0" id="ctrlMarinos" class="form-control" placeholder="Control Marinos"></label>
          <label>Marinos Argos <input type="number" min="0" id="marinosArgos" class="form-control" placeholder="Argos"></label>
          <label>Cruceros <input type="number" min="0" id="cruceros" class="form-control" placeholder="Cruceros"></label>
          <label>Cruceristas <input type="number" min="0" id="cruceristas" class="form-control" placeholder="Pasajeros"></label>
        </div>
        <div class="row-cols" style="gap:1.1em;">
          <label>Visados CGEF <input type="number" min="0" id="visadosCgef" class="form-control" placeholder="CGEF"></label>
          <label>Visados Valencia <input type="number" min="0" id="visadosValencia" class="form-control" placeholder="Valencia"></label>
          <label>Visados Expedidos <input type="number" min="0" id="visadosExp" class="form-control" placeholder="Expedidos"></label>
          <label>Vehículos Chequeados <input type="number" min="0" id="vehChequeados" class="form-control" placeholder="Veh."></label>
          <label>Pasajeros Chequeados <input type="number" min="0" id="paxChequeadas" class="form-control" placeholder="Pax."></label>
        </div>
        <div class="row-cols" style="gap:1.1em;">
          <label>Detenidos <input type="number" min="0" id="detenidos" class="form-control" placeholder="Detenidos"></label>
          <label>Denegaciones <input type="number" min="0" id="denegaciones" class="form-control" placeholder="Denegaciones"></label>
          <label>Entr. Excep. <input type="number" min="0" id="entrExcep" class="form-control" placeholder="Entr. Excep."></label>
          <label>EIXICS <input type="number" min="0" id="eixics" class="form-control" placeholder="EIXICS"></label>
          <label>Puertos Deportivos <input type="number" min="0" id="ptosDeportivos" class="form-control" placeholder="Ptos. Deportivos"></label>
        </div>
        <!-- FERRYS -->
        <h4 class="mt-4">Ferrys 
          <button class="ayuda-btn" type="button" title="Ayuda sobre ferrys" 
            onclick="alert('Añade cada ferry indicando tipo, fecha, hora, pasajeros, vehículos y una posible incidencia.')">?</button>
        </h4>
        <div class="mini-form-ferry">
          <select id="ferryTipo" class="form-control" title="Tipo">
            <option value="Llegada">Llegada</option>
            <option value="Salida">Salida</option>
          </select>
          <input type="text" id="ferryDestino" class="form-control" placeholder="Destino" title="Destino">
          <input type="date" id="ferryFecha" class="form-control" title="Fecha">
          <input type="time" id="ferryHora" class="form-control" title="Hora">
          <input type="number" min="0" id="ferryPasajeros" class="form-control" placeholder="Pasaj." title="Pasajeros">
          <input type="number" min="0" id="ferryVehiculos" class="form-control" placeholder="Vehíc." title="Vehículos">
          <input type="text" id="ferryIncidencia" class="form-control" placeholder="Incidencia (opcional)" title="Incidencia">
          <button type="button" class="btn btn-police-blue" id="btnAddFerry">➕ Añadir</button>
        </div>
        <!-- Listado de ferrys -->
        <div class="ventana-datos ventana-ferrys" id="ferrysListWindow"></div>
        <div class="totales-ferry">
          Ferrys: <span id="totalFerrys">0</span> |
          Pasaj.: <span id="totalPasajeros">0</span> |
          Vehíc.: <span id="totalVehiculos">0</span>
        </div>

        <!-- Observaciones -->
        <h4 class="mt-4">Observaciones</h4>
        <textarea id="observaciones" class="form-control" placeholder="Observaciones, incidencias..."></textarea>
        
        <!-- Adjuntos -->
        <label class="mt-3">Adjuntar doc./imágenes
          <input type="file" id="adjuntos" class="form-control" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
        </label>
      </div>
    </form>

    <!-- RESUMEN AVANZADO / EXPORTACIÓN -->
    <div class="card p-4 mt-4" id="panelResumenAvanzado">
      <h4>
        Resumen avanzado
        <button class="ayuda-btn" type="button" title="Resumen y exportación"
          onclick="alert('Puedes generar un resumen por rango de fechas y exportar los datos en PDF, CSV o copiar para WhatsApp.')">?</button>
      </h4>
      <div class="row-cols mb-2 resumen-fechas-row">
        <label for="desdeResumen">Desde</label>
        <input type="date" id="desdeResumen" class="form-control input-date">
        <label for="hastaResumen">Hasta</label>
        <input type="date" id="hastaResumen" class="form-control input-date">
        <button id="btnGenerarResumen" class="btn btn-police-green" type="button" style="height:38px; margin-left:.5em;">📋 Resumen</button>
      </div>
      <div class="export-btns d-flex flex-wrap" style="gap:9px;">
        <button id="btnExportarPDF" class="btn btn-police-blue" type="button"><span>📄</span> PDF</button>
        <button id="btnExportarCSV" class="btn btn-police-yellow" type="button"><span>📊</span> CSV</button>
        <button id="btnWhatsapp" class="btn btn-police-green" type="button"><span>💬</span> WA</button>
      </div>
      <div id="resumenAvanzadoVentana" class="ventana-datos mt-3"></div>
    </div>

    <div class="card p-4 mt-4" id="panelResumenPuerto" style="display:none;">
      <h4>Resumen del día</h4>
      <div id="resumenPuerto"></div>
    </div>
  </main>
  <footer class="footer bg-police-blue text-center text-white py-3">
    SIREX · UCRIF · Grupo Puerto &copy; 2025
  </footer>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-storage-compat.js"></script>
  <script src="../js/puerto.js"></script>
  <script>
    // =========== MODO OSCURO ===========
    const darkBtn = document.getElementById("darkModeBtn");
    if (darkBtn) {
      darkBtn.onclick = function() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("sirex_darkmode", document.body.classList.contains("dark-mode") ? "1" : "0");
        darkBtn.innerText = document.body.classList.contains("dark-mode") ? "☀️" : "🌙";
      };
      if (localStorage.getItem("sirex_darkmode") === "1") {
        document.body.classList.add("dark-mode");
        darkBtn.innerText = "☀️";
      }
    }
  </script>
</body>
</html>
